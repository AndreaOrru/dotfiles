#!/bin/sh

linkConfig() {
  SRC=$1   # Source directory.
  DEST=$2  # Target directory.
  AS=$3    # User.

  cd $SRC

  # Create all directories.
  find -type d -exec sudo -u $AS mkdir -p $DEST/{} \;

  # Link all files.
  find ! -type d | sed 's|^./||' | xargs -i sudo -u $AS ln -vsf $PWD/{} $DEST/{}
}


systemConfig() {
  linkConfig system /etc/nixos root

  # Link the auto-generated hardware configuration.
  ln -vsf /etc/nixos/hardware-configuration.nix .
}

userConfig() {
  linkConfig user $HOME $USER

  # Install Spacemacs.
  git clone -b develop https://github.com/syl20bnr/spacemacs ~/.emacs.d

  # Install Heroku.
  npm install -g heroku
}

dconfConfig() {
  dconf load / < dconf/config
}


test "$1" == "system" && systemConfig
test "$1" == "user"   && userConfig
test "$1" == "dconf"  && dconfConfig
