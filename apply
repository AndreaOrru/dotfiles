#!/bin/sh

DOTFILES=$PWD

# TODO: contains instead of == and !=

if [ "$1" != "--skip-save" ]; then
  aconfmgr save
fi

if [[ "$1" != "--force" && -n "$(git status -s)" ]]; then
  echo "The dotfiles repository contains local changes."
  exit 1
fi

git pull
# TODO: git pull - check if there are changes
aconfmgr apply

cd $DOTFILES/user    && ./install
cd $DOTFILES/private && ./install

if [ "$1" == "--dconf" ]; then
  cd $DOTFILES/dconf && ./install
fi
